<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart — NareshKart</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; font-family:Arial; background:#f5f5f5; }

nav {
  background:#1a1a2e;
  color:#fff;
  padding:16px 32px;
  display:flex;
  justify-content:space-between;
}

nav a { color:#fff; text-decoration:none; margin-left:14px; }

.container {
  padding:32px;
}

.item {
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.controls button {
  padding:6px 10px;
  margin-left:6px;
  border:none;
  cursor:pointer;
}

.total {
  margin-top:24px;
  font-size:18px;
  font-weight:bold;
}

.checkout-btn {
  margin-top:16px;
  padding:12px 20px;
  background:#e94560;
  color:#fff;
  border:none;
  cursor:pointer;
  border-radius:6px;
}
</style>
</head>
<body>

<nav>
  <strong>Naresh<span style="color:#e94560">Kart</span></strong>
  <div>
    <a href="home.html">Home</a>
    <a href="products.html">Shop</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</nav>

<div class="container">
  <h2>Your Cart</h2>
  <div id="cart-items"></div>
  <div class="total">Total: ₹<span id="total">0</span></div>
  <button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
</div>

<script>
const API = "/api";
const token = localStorage.getItem("nk_token");
if (!token) location.href = "login.html";

const headers = {
  "Content-Type":"application/json",
  "Authorization":"Bearer "+token
};

let cart = [];

async function loadCart() {
  const res = await fetch(API + "/cart", {headers});
  cart = await res.json();
  render();
}

function render() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";

  let total = 0;

  cart.forEach(item => {
    total += item.price * item.qty;

    container.innerHTML += `
      <div class="item">
        <div>
          <div><strong>${item.name}</strong></div>
          <div>₹${item.price} × ${item.qty}</div>
        </div>
        <div class="controls">
          <button onclick="changeQty(${item.product_id}, -1)">-</button>
          <button onclick="changeQty(${item.product_id}, 1)">+</button>
          <button onclick="removeItem(${item.product_id})">Remove</button>
        </div>
      </div>
    `;
  });

  document.getElementById("total").textContent = total;
}

async function changeQty(id, delta) {
  await fetch(API+"/cart",{
    method:"POST",
    headers:headers,
    body:JSON.stringify({product_id:id, qty:delta})
  });
  loadCart();
}

async function removeItem(id) {
  await fetch(API+"/cart/"+id,{
    method:"DELETE",
    headers:headers
  });
  loadCart();
}

function checkout() {
  if (cart.length === 0) return alert("Cart empty");
  localStorage.removeItem("buy_now");
  location.href = "checkout.html";
}

function logout(){
  localStorage.clear();
  location.href="login.html";
}

loadCart();
</script>

</body>
</html>
