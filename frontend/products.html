<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Products ‚Äî NareshKart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,sans-serif;background:#f5f5f5}
    nav{background:#1a1a2e;color:#fff;padding:16px 32px;display:flex;justify-content:space-between;align-items:center}
    nav a{color:#fff;text-decoration:none;margin-left:16px;font-weight:600;font-size:14px}
    .controls{padding:20px 32px;display:flex;gap:12px;flex-wrap:wrap;background:#fff;border-bottom:1px solid #eee}
    .controls input,.controls select{padding:10px 14px;border-radius:6px;border:1px solid #ddd;font-size:14px;outline:none}
    .controls input{flex:1;min-width:180px}
    .products{padding:24px 32px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}
    .card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .card h4{margin-bottom:4px;color:#1a1a2e}
    .category{font-size:12px;color:#888;margin-bottom:6px}
    .price{color:#e94560;font-weight:700;font-size:1.1rem;margin-bottom:10px}
    .actions{display:flex;gap:6px;flex-wrap:wrap}
    .btn{flex:1;padding:8px;border:none;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px}
    .btn-cart{background:#1a1a2e;color:#fff}
    .btn-buy{background:#e94560;color:#fff}
    .btn-wish{background:#fff;color:#e94560;border:1px solid #e94560}
    .toast{position:fixed;bottom:24px;right:24px;background:#27ae60;color:#fff;padding:12px 20px;border-radius:6px;font-size:14px;display:none;z-index:999}
    .empty{padding:48px;text-align:center;color:#888;grid-column:1/-1}
  </style>
</head>
<body>
<nav>
  <div><strong>Naresh<span style="color:#e94560">Kart</span></strong></div>
  <div>
    <a href="home.html">Home</a>
    <a href="cart.html">Cart</a>
    <a href="wishlist.html">Wishlist</a>
    <a href="profile.html">Profile</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</nav>

<div class="controls">
  <input type="text" id="search" placeholder="üîç Search products..." oninput="render()"/>
  <select id="category" onchange="render()">
    <option value="">All Categories</option>
    <option>Books</option>
    <option>Materials</option>
    <option>Gadgets</option>
  </select>
  <select id="sort" onchange="render()">
    <option value="">Sort by</option>
    <option value="asc">Price: Low to High</option>
    <option value="desc">Price: High to Low</option>
  </select>
</div>

<div class="products" id="product-list"><div class="empty">Loading...</div></div>
<div class="toast" id="toast"></div>

<script>
const API="/api";
const token=localStorage.getItem("nk_token");
if(!token)window.location.href="login.html";
const headers={"Content-Type":"application/json","Authorization":"Bearer "+token};
let products=[];

function toast(msg,ok=true){
  const t=document.getElementById("toast");
  t.textContent=msg; t.style.background=ok?"#27ae60":"#e94560";
  t.style.display="block"; setTimeout(()=>t.style.display="none",2500);
}

async function loadProducts(){
  const res=await fetch(API+"/products");
  products=await res.json();
  render();
}

function render(){
  const q=document.getElementById("search").value.toLowerCase();
  const cat=document.getElementById("category").value;
  const sort=document.getElementById("sort").value;
  let list=products.filter(p=>(!cat||p.category===cat)&&p.name.toLowerCase().includes(q));
  if(sort==="asc")list.sort((a,b)=>a.price-b.price);
  else if(sort==="desc")list.sort((a,b)=>b.price-a.price);
  const c=document.getElementById("product-list");
  if(!list.length){c.innerHTML='<div class="empty">No products found.</div>';return;}
  c.innerHTML=list.map(p=>`
    <div class="card">
      <h4>${p.emoji||""} ${p.name}</h4>
      <div class="category">${p.category}</div>
      <div class="price">‚Çπ${p.price}</div>
      <div class="actions">
        <button class="btn btn-cart" onclick="addToCart(${p.id})">üõí Cart</button>
        <button class="btn btn-buy" onclick="buyNow(${p.id})">‚ö° Buy</button>
        <button class="btn btn-wish" onclick="addToWishlist(${p.id})">‚ô°</button>
      </div>
    </div>`).join("");
}

async function addToCart(id){
  const res=await fetch(API+"/cart",{method:"POST",headers,body:JSON.stringify({product_id:id,qty:1})});
  if(res.ok)toast("Added to cart üõí"); else toast("Error adding to cart",false);
}

async function addToWishlist(id){
  const res=await fetch(API+"/wishlist",{method:"POST",headers,body:JSON.stringify({product_id:id})});
  if(res.ok)toast("Added to wishlist ‚ù§Ô∏è");
}

function buyNow(id){localStorage.setItem("buy_now",id);window.location.href="checkout.html";}
function logout(){localStorage.clear();window.location.href="login.html";}

loadProducts();
</script>
</body>
</html>
